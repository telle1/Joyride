{% extends 'base.html' %}
{% block title %} Search Results {% endblock %}
{% block head %} 
<link rel="stylesheet" href="../static/css/inner.css" />
{% endblock %}

{% block body %}
<div class="container search-container">
  <div class="row">
      <form action='/search-complete' class="form-inline mx-auto f-grey" id="search-rides">
          <input type="text" class="form-control mr-2" name="from_input" id = "from_input" placeholder="Start Location">
          <input type="text" class="form-control mr-2" name="to_input" id= "to_input" placeholder="Destination">
          <input type="date" class="form-control" name="date">
          <button type="submit" class="btn btn-theme my-1">Search</button>
      </form>
  </div>

  <div class="msg mt-3" id="msg"></div>
  {% if matching_rides|length >= 1 %}
  <h2 class="mt-4 font-weight-bold">Search Results for {{matching_rides[0].start_loc}} to {{matching_rides[0].end_loc}}</h2>
  <div class = "row mt-4">
    {% for ride in matching_rides %}
      <div class="col-md-6">
        <div class="card mb-3">
          <form action='/request-ride.json' method = "post" id="form-request-{{ride.ride_id}}">
            <h5 class="card-header btn-theme">{{ride.date}} </h5>
            <div class="card-body">
              <div class="row">

                <div class="col-md-8">
                  <h4 class="card-title font-weight-bold">{{ride.user.first_name}} {{ride.user.first_name}}</h4>
                </div>

                <div class="col-md-4">
                  <div class="card-text text-right"> 
                   <h3 class = "mb-0 font-weight-bold">{{ride.seats}} seats </h3>
                   <h3 class = "font-weight-bold">${{ride.price}} each</h3>
                  </div>
                </div>
              </div>

                <p class="card-text">Driver comments: {{ride.comments}}</p>
                
                <p class="card-text">driverid = {{ride.driver_id}} rideid = {{ride.ride_id}}</p>
                <input type="hidden" value = {{ride.driver_id}} name = "driver_id" id = "driver_id"> 
                <input type="hidden" value = {{ride.ride_id}} name = "ride_id" id = "ride_id"> 

                <button class = 'btn btn-theme' type = "submit" id="submit-button">Request ride</button>
                
            
            </div>
          </form>
        </div> 

      </div>
    
    {% endfor %}

    {% else %}
    <h3 class="mt-4">No rides found</p>
    {% endif %}
  </div>
</div>
  {% endblock %}

  {% block script %}
  {% for ride in matching_rides %}

  <script>
    function alertRequest(evt){
      evt.preventDefault();
      console.log('THIS IS THE ID OF THE RIDE', {{ride.ride_id}})
      let url = '/request-ride.json';
      let formData = {
        "driver_id": {{ride.driver_id}},
        "ride_id": {{ride.ride_id}}
      };

      console.log(formData)

      $.post(url, formData, (res) => {
        console.log(res)
        $('#msg').html('<p>' + res.msg + '<p>')
      })

    }

    $('#form-request-{{ride.ride_id}}').on('submit', alertRequest);
  </script>
  {% endfor %}
  {% endblock %}